<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yeqifu.mybatis.dao.EmployeeMapperDynamicSQL">
	
	<select id="getEmployeeByConditionIf" resultType="com.yeqifu.mybatis.bean.Employee">
		select *
		from tbl_employee
		<!-- 
			查询的时候如果某些条件没带可能sql拼装会有问题：
				1、给where后面加上1=1，以后的条件都and xxx.
				2、mybatis使用where标签来将所有的查询条件包括在内。mybatis就会将where标签中拼装的sql，多出来的and或者or去掉
				   where只会去掉第一个多出来的and或者or。 
		-->
		<where>
			<!-- 
				test：判断表达式
				从参数中取值进行判断
			 -->
			<if test="id!=null">
				id=#{id}
			</if>
			<if test="lastName!=null and lastName!=''">
				and last_name like #{lastName} 
			</if>
			<if test="email!=null">
				and email = #{email} 
			</if>
			<if test="gender==0 or gender==1">
				and gender = #{gender}
			</if>
		</where>
	</select>
	
	<select id="getEmployeeByConditionTrim" resultType="com.yeqifu.mybatis.bean.Employee">
		select *
		from tbl_employee
		<!-- 
			后面多出的and或者or  where标签不能解决
			trim：trim标签体中是整个字符串拼串后的结果
			prefix=""：前缀
					   prefix给拼串后的整个字符串加一个前缀
			prefixOverrides=""：
					   前缀覆盖：去掉整个字符串前面多余的字符
			suffix=""：后缀		
					   suffix给拼串后的整个字符串加一个后缀
		    suffixOverrides=""：
		    		 后缀覆盖：去掉整个字符串后面多余的字符   
		 -->
		 <!-- 自定义字符串的截取规则 -->
		<trim prefix="where" suffixOverrides="and">
			<if test="id!=null">
				id=#{id} and
			</if>
			<if test="lastName!=null and lastName!=''">
				last_name like #{lastName} and
			</if>
			<if test="email!=null">
				email = #{email} and
			</if>
			<if test="gender==0 or gender==1">
				gender = #{gender}
			</if>
		</trim>
	</select>
	
	<select id="getEmployeeByConditionChoose" resultType="com.yeqifu.mybatis.bean.Employee">
		select *
		from tbl_employee
		<where>
			<choose>
				<when test="id!=null">
					id=#{id}
				</when>
				<when test="lastName!=null">
					last_name like #{lastName}
				</when>
				<when test="email!=null">
					email = #{email}
				</when>
				<otherwise>
					gender=0
				</otherwise>
			</choose>
		</where>
	</select>
</mapper>